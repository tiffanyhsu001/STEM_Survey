---
title: "Stress Analysis"
output: html_notebook
---

```{r}
stem = read.csv("stem_newfactors.csv", na.strings=c("",NA))
head(stem)
```

### Exploratory Analysis
```{r}
library(gdata)

# clean data
stem$Gender[stem$Gender == 'Genderfluid' |  stem$Gender == 'Transgender female'] <- NA
stem = stem[!is.na(stem$Gender),]
stem$Orientation[stem$Orientation == 'straight'] <- 'Heterosexual'
stem = drop.levels(stem)


# gender
barplot(tapply(stem$Stress_Factor, stem$Gender, mean), main="Gender vs. Average Stress Level")

# orientation
barplot(tapply(stem$Stress_Factor, stem$Orientation, mean), main="Sexual Orientation vs. Average Stress Level")

# year
# refactor order
stem$Year <- factor(stem$Year, levels = c("Freshman", "Sophomore", "Junior", "Senior", "Fifth Year", "Graduate Student"))
barplot(tapply(stem$Stress_Factor, stem$Year, mean), main="Year vs. Average Stress Level")


# international
barplot(tapply(stem$Stress_Factor, stem$International, mean,na.rm=TRUE), main="International vs. Average Stress Level")

# transfer
barplot(tapply(stem$Stress_Factor, stem$Transfer, mean,na.rm=TRUE), main="Transfer vs. Average Stress Level")

# efl
barplot(tapply(stem$Stress_Factor, stem$EFL, mean), main="EFL vs. Average Stress Level")

# first gen
barplot(tapply(stem$Stress_Factor, stem$FirstGen, mean,na.rm=TRUE), main="First Gen vs. Average Stress Level")

# gpa
stem$GPA[stem$GPA == 0] <- NA
#range(stem$GPA,na.rm=TRUE)

stem$GPA[stem$GPA < 3.0] = "< 3.0"
stem$GPA[stem$GPA >= 3.0 & stem$GPA <= 3.5] = "3.0 <= x <= 3.5"
stem$GPA[stem$GPA > 3.5] = ">3.5"

stem$GPA <- factor(stem$GPA, levels = c("< 3.0", "3.0 <= x <= 3.5", ">3.5"))

barplot(tapply(stem$Stress_Factor, stem$GPA, mean,na.rm=TRUE), main="GPA vs. Average Stress Level")
```

```{r}
# q3.2, .5, .15, ethnic, year, gender
# how correlated are these variables with the stress_factor variable

stem$GPA[stem$GPA == 0] = mean(stem$GPA) 
target = stem[,'Stress_Factor']


q2 = stem[,'Q3.2']
q5 = stem[,'Q3.5']
q15 = stem[,'Q3.15']
q14 = stem[,'Q3.14']
ses = stem[,'SES_Factor']


cor(q2, target)
res <- cor.test(q2, target, 
                    method = "pearson")
res$p.value
barplot(tapply(target, q2, mean), main = 'Q3.2 versus Stress Level', ylab = 'Stress Level', xlab = 'Level of preparedness from hs for STEM', ylim = c(10, 13)) 

cor(q5, target)
res <- cor.test(q5, target, 
                    method = "pearson")
res$p.value
barplot(tapply(target, q5, mean), main = 'Q3.5 versus Stress Level', ylab = 'Stress Level', xlab = 'Level of work needed to pay for expenses', ylim = c(8, 12)) 

cor(q14, target)
res <- cor.test(q14, target, 
                    method = "pearson")
res$p.value
barplot(tapply(target, q14, mean), main = 'Q3.14 versus Stress Level', ylab = 'Stress Level', xlab = 'To what extent do you seek help when you have an academic problem', ylim = c(9, 12))

cor(ses, target)
res <- cor.test(ses, target, 
                    method = "pearson")
res$p.value
barplot(tapply(target, ses, mean), main = 'SES versus Stress Level', ylab = 'Stress Level', xlab = 'SES', ylim = c(8,12))

```

```{r}
# exploratory analysis: belonging questions (taken from factor analysis) 3.15 (checked above), 3.16, 3.19 - 3.24 summed
q15 = stem[,'Q3.15']
q16 = stem[,'Q3.16']
q19 = stem[,'Q3.19']
q20 = stem[,'Q3.20']
q21 = stem[,'Q3.21']
q22 = stem[,'Q3.22']
q23 = stem[,'Q3.23']
q24 = stem[,'Q3.24']

cor(q15, target)
res <- cor.test(q15, target, 
                    method = "pearson")
res$p.value # not significant
barplot(tapply(target, q15, mean), main = 'Q3.15 versus Stress Level', ylab = 'Stress Level', xlab = 'To what extent do you know what you want to do after graduation') 

cor(q16, target)
res <- cor.test(q16, target, method = "pearson") 
res$p.value # significant
barplot(tapply(target, q16, mean), main = 'Q3.16 versus Stress Level', ylab = 'Stress Level', xlab = 'Q3.16')

cor(q19, target)
res <- cor.test(q19, target, method = "pearson") 
res$p.value # significant
barplot(tapply(target, q19, mean), main = 'Q3.19 versus Stress Level', ylab = 'Stress Level', xlab = 'Q3.19')

cor(q20, target)
res <- cor.test(q20, target, method = "pearson") 
res$p.value # not significant
barplot(tapply(target, q20, mean), main = 'Q3.20 versus Stress Level', ylab = 'Stress Level', xlab = 'Q3.20')

cor(q21, target)
res <- cor.test(q21, target, method = "pearson") 
res$p.value # significant
barplot(tapply(target, q21, mean), main = 'Q3.21 versus Stress Level', ylab = 'Stress Level', xlab = 'Q3.21')

cor(q22, target)
res <- cor.test(q22, target, method = "pearson") 
res$p.value # significant
barplot(tapply(target, q22, mean), main = 'Q3.22 versus Stress Level', ylab = 'Stress Level', xlab = 'Q3.22')

cor(q23, target)
res <- cor.test(q23, target, method = "pearson") 
res$p.value # significant
barplot(tapply(target, q23, mean), main = 'Q3.23 versus Stress Level', ylab = 'Stress Level', xlab = 'Q3.23')

cor(q24, target)
res <- cor.test(q24, target, method = "pearson") 
res$p.value # significant
barplot(tapply(target, q24, mean), main = 'Q3.24 versus Stress Level', ylab = 'Stress Level', xlab = 'Q3.24')

# Q3.16, 3.19, 3.21-3.24 all significant
```


```{r}
# ANOVA
gender <- aov(Stress_Factor~Gender, data = stem)
summary(gender) # significantly different

orientation <- aov(Stress_Factor~Orientation, data = stem)
summary(orientation) # not significantly different

year <- aov(Stress_Factor~Year, data = stem)
summary(year) # not significantly different

international <- aov(Stress_Factor~International, data = stem)
summary(international) # significantly different

transfer <- aov(Stress_Factor~Transfer, data = stem)
summary(transfer) # not significantly different

efl <- aov(Stress_Factor~EFL, data = stem)
summary(efl) # not significantly different

firstgen <- aov(Stress_Factor~FirstGen, data = stem)
summary(firstgen) # significantly different

# simple linear reg
gpa_lm <- lm(Stress_Factor ~ GPA, data = stem)
summary(gpa_lm) # gpa is significant 

# we will use gender, firstgen, and gpa in our linear reg, Q3.2, Q3.5, Q3.14
```

## Modeling
We have broken up our final variables into 3 separate subcategories, or blocks. We should check each block individually and see which is most important.

Block1: SES - Q3.2, Q3.5

Block2: Demographics - Gender, FirstGen

Block3: Academic Awareness/Direction: Q3.14, GPA

Block4: Belonging Q3.16, 3.19, 3.21-3.24
```{r}
# block1
ses = lm(Stress_Factor ~ as.factor(Q3.2) + as.factor(Q3.5), data=stem)
summary(ses)
# adj R2 0.1004 

# block 2 
dem = lm(Stress_Factor ~ Gender + FirstGen, data=stem)
summary(dem)
# adj R2 0.06056

# block 3 
aca = lm(Stress_Factor ~ as.factor(Q3.14) + GPA, data=stem)
summary(aca)
# adj R2 0.06923

# block 4 
bel = lm(Stress_Factor ~ as.factor(Q3.16) + as.factor(Q3.19) + as.factor(Q3.21) + as.factor(Q3.22) + as.factor(Q3.23)+ as.factor(Q3.24), data=stem)
summary(bel)
# adj R2 0.2304. use this as base 


# block4 + block1
m1 = lm(Stress_Factor ~ as.factor(Q3.16) + as.factor(Q3.19) + as.factor(Q3.21) + as.factor(Q3.22) + as.factor(Q3.23)+ as.factor(Q3.24) + as.factor(Q3.2) + as.factor(Q3.5), data=stem)
summary(m1)
# adj R2 0.2634

# block4 + block2
m2 = lm(Stress_Factor ~ as.factor(Q3.16) + as.factor(Q3.19) + as.factor(Q3.21) + as.factor(Q3.22) + as.factor(Q3.23)+ as.factor(Q3.24) + Gender + FirstGen, data=stem)
summary(m2)
# adj R2 0.2552


# block4 + block3
m3 = lm(Stress_Factor ~ as.factor(Q3.16) + as.factor(Q3.19) + as.factor(Q3.21) + as.factor(Q3.22) + as.factor(Q3.23)+ as.factor(Q3.24) + as.factor(Q3.14) + GPA, data=stem)
summary(m3)
# adj R2 0.2649, highest of 2 blocks

# block4 + block3 + block1
m4 = lm(Stress_Factor ~ as.factor(Q3.16) + as.factor(Q3.19) + as.factor(Q3.21) + as.factor(Q3.22) + as.factor(Q3.23)+ as.factor(Q3.24) + as.factor(Q3.14) + GPA + as.factor(Q3.2) + as.factor(Q3.5), data=stem)
summary(m4)
# adj R2 0.2874

# block4 + block3 + block2
m5 = lm(Stress_Factor ~ as.factor(Q3.16) + as.factor(Q3.19) + as.factor(Q3.21) + as.factor(Q3.22) + as.factor(Q3.23)+ as.factor(Q3.24) + as.factor(Q3.14) + GPA + Gender + FirstGen, data=stem)
summary(m5)
# adj R2 0.2881

# block4 + block3 + block2 + block1
m6 = lm(Stress_Factor ~ as.factor(Q3.16) + as.factor(Q3.19) + as.factor(Q3.21) + as.factor(Q3.22) + as.factor(Q3.23)+ as.factor(Q3.24) + as.factor(Q3.14) + GPA + Gender + FirstGen + as.factor(Q3.2) + as.factor(Q3.5), data=stem)
summary(m6)
# adj R2 0.3026
```
Block4: Belonging had the most influence on increasing R2 for Stress.  

## Plots
```{r}
stem$Q3.2 = as.factor(stem$Q3.2)

interaction.plot(stem$GPA, stem$Q3.2, stem$Stress_Factor,xlab="GPA", ylab="Stress_Factor", trace.label="HS Prep STEM")
```

For students who strongly felt their HS prepped them well for STEM (level=4), their stress levels decreased drastically as GPA increases.
Overall students who strongly felt their HS did NOT prep for STEM (level=1) had the highest overall stress, across all GPAs, and their stress levels only slightly decrease with higher GPA. 
For students who felt their HS slightly prepared them for STEM (level=2), had high stress at low GPAs and dropped drastically as GPA increased. 
For students who felt their HS prepared them for STEM (level=3) had the overall lowest stress throughout all GPAs, and stress levels remained the same no matter what GPA the students had.

```{r}
# t-test between GPA and stess levels (maybe?)
```




